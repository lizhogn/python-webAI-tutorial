# 3.4 è·¯ç”±å’Œå¯¼èˆªï¼šæ„å»ºå•é¡µåº”ç”¨ (SPA)

## ğŸ“– æ¦‚è¿°

åœ¨ä¼ ç»Ÿçš„ç½‘ç«™ä¸­ï¼Œæ¯ä¸ª URL å¯¹åº”ä¸€ä¸ª HTML æ–‡ä»¶ï¼Œç‚¹å‡»é“¾æ¥ä¼šä»æœåŠ¡å™¨åŠ è½½ä¸€ä¸ªå…¨æ–°çš„é¡µé¢ã€‚è€Œåœ¨**å•é¡µåº”ç”¨ (Single-Page Application, SPA)** ä¸­ï¼Œæ•´ä¸ªåº”ç”¨åªåœ¨ä¸€ä¸ªé¡µé¢ä¸Šè¿è¡Œã€‚æˆ‘ä»¬é€šè¿‡**å‰ç«¯è·¯ç”±**æ¥æ‹¦æˆªæµè§ˆå™¨çš„å¯¼èˆªï¼ŒåŠ¨æ€åœ°åœ¨å½“å‰é¡µé¢ä¸Šæ¸²æŸ“ä¸åŒçš„ç»„ä»¶ï¼Œæ¨¡æ‹Ÿå‡ºé¡µé¢åˆ‡æ¢çš„æ•ˆæœï¼Œè€Œæ— éœ€é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢ã€‚

**Vue Router** æ˜¯ Vue.js å®˜æ–¹çš„è·¯ç”±ç®¡ç†å™¨ï¼Œå®ƒèƒ½è®©æˆ‘ä»¬è½»æ¾åœ°å°† URL æ˜ å°„åˆ°ç»„ä»¶ã€‚

## ğŸš€ å¿«é€Ÿä¸Šæ‰‹ Vue Router

### æ­¥éª¤ 1: å®‰è£… Vue Router
åœ¨ä½ çš„ Vue é¡¹ç›®ä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```bash
npm install vue-router@4
# æˆ–è€…
yarn add vue-router@4
```
> å¦‚æœä½ åœ¨åˆ›å»ºé¡¹ç›®æ—¶ï¼ˆé€šè¿‡ `npm create vue@latest`ï¼‰å·²ç»é€‰æ‹©äº†æ·»åŠ  Vue Routerï¼Œåˆ™å¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ã€‚

### æ­¥éª¤ 2: åˆ›å»ºå’Œé…ç½®è·¯ç”±
æˆ‘ä»¬é€šå¸¸åœ¨ `src/router/index.js` æ–‡ä»¶ä¸­é…ç½®è·¯ç”±ã€‚

```js
// src/router/index.js
import { createRouter, createWebHistory } from 'vue-router'
import HomeView from '../views/HomeView.vue'
import AboutView from '../views/AboutView.vue'

// 1. å®šä¹‰è·¯ç”±è¡¨ (Routes)
// æ¯ä¸ªè·¯ç”±éƒ½åº”è¯¥æ˜ å°„åˆ°ä¸€ä¸ªç»„ä»¶
const routes = [
  {
    path: '/',
    name: 'home',
    component: HomeView
  },
  {
    path: '/about',
    name: 'about',
    component: AboutView
  }
]

// 2. åˆ›å»ºè·¯ç”±å®ä¾‹
const router = createRouter({
  // ä½¿ç”¨ HTML5 History æ¨¡å¼ï¼ŒURL æ›´ç¾è§‚
  history: createWebHistory(import.meta.env.BASE_URL),
  routes
})

export default router
```

### æ­¥éª¤ 3: æ³¨å†Œè·¯ç”±å®ä¾‹
åœ¨é¡¹ç›®å…¥å£æ–‡ä»¶ (`main.js`) ä¸­ï¼Œå°†è·¯ç”±å®ä¾‹ä½œä¸ºæ’ä»¶æ³¨å†Œåˆ° Vue åº”ç”¨ä¸­ã€‚

```js
// main.js
import { createApp } from 'vue'
import App from './App.vue'
import router from './router' // å¯¼å…¥è·¯ç”±

const app = createApp(App)

app.use(router) // ä½¿ç”¨è·¯ç”±
app.mount('#app')
```

## ğŸ—ï¸ è·¯ç”±çš„æ ¸å¿ƒç»„ä»¶

### `<router-view>`: è·¯ç”±å‡ºå£
`router-view` ç»„ä»¶æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œå®ƒä¼šæ ¹æ®å½“å‰ URL æ¸²æŸ“åŒ¹é…åˆ°çš„è·¯ç”±ç»„ä»¶ã€‚ä½ åº”è¯¥æŠŠå®ƒæ”¾åœ¨ä½ å¸Œæœ›å±•ç¤ºé¡µé¢å†…å®¹çš„åœ°æ–¹ã€‚

```vue
<!-- App.vue -->
<template>
  <header>
    <!-- å¯¼èˆªé“¾æ¥ -->
  </header>
  
  <main>
    <!-- è·¯ç”±åŒ¹é…åˆ°çš„ç»„ä»¶å°†åœ¨è¿™é‡Œæ¸²æŸ“ -->
    <router-view />
  </main>
</template>
```

### `<router-link>`: å¯¼èˆªé“¾æ¥
`router-link` ç»„ä»¶ç”¨äºç”Ÿæˆå¯¼èˆªé“¾æ¥ã€‚å®ƒä¼šè¢«æ¸²æŸ“æˆä¸€ä¸ªå¸¦æœ‰æ­£ç¡® `href` çš„ `<a>` æ ‡ç­¾ã€‚

```vue
<!-- components/NavBar.vue -->
<template>
  <nav>
    <router-link to="/">é¦–é¡µ</router-link>
    <router-link to="/about">å…³äºæˆ‘ä»¬</router-link>
  </nav>
</template>
```

## ğŸ”— åŠ¨æ€è·¯ç”±ä¸è·¯ç”±å‚æ•°

æˆ‘ä»¬ç»å¸¸éœ€è¦å°†å…·æœ‰ç»™å®šæ¨¡å¼çš„ URL åŒ¹é…åˆ°åŒä¸€ä¸ªç»„ä»¶ï¼Œä¾‹å¦‚ï¼Œæ‰€æœ‰ç”¨æˆ·çš„ä¸ªäººä¸»é¡µã€‚è¿™å¯ä»¥é€šè¿‡**åŠ¨æ€è·¯ç”±**å®ç°ã€‚

```js
// src/router/index.js
const routes = [
  // åŠ¨æ€å­—æ®µä»¥ `:` å¼€å¤´
  { 
    path: '/users/:id', 
    name: 'user', 
    component: UserView 
  }
]
```
ç°åœ¨ï¼Œåƒ `/users/123` å’Œ `/users/456` è¿™æ ·çš„ URL éƒ½ä¼šåŒ¹é…åˆ° `UserView` ç»„ä»¶ã€‚

åœ¨ç»„ä»¶å†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `useRoute` é’©å­æ¥è®¿é—®å½“å‰è·¯ç”±çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è·¯ç”±å‚æ•°ã€‚
```vue
<!-- views/UserView.vue -->
<script setup>
import { useRoute } from 'vue-router'
import { ref, onMounted } from 'vue'

const route = useRoute()
const userId = ref(route.params.id)

onMounted(() => {
  console.log(`å½“å‰ç”¨æˆ· ID æ˜¯: ${userId.value}`)
})
</script>

<template>
  <h1>ç”¨æˆ·èµ„æ–™é¡µï¼š{{ userId }}</h1>
</template>
```

## ğŸ‘¨â€ğŸ’» ç¼–ç¨‹å¼å¯¼èˆª

é™¤äº†ä½¿ç”¨ `<router-link>` åˆ›å»ºå¯¼èˆªé“¾æ¥ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ JavaScript ä»£ç ä¸­è¿›è¡Œé¡µé¢è·³è½¬ï¼Œè¿™ç§°ä¸º**ç¼–ç¨‹å¼å¯¼èˆª**ã€‚è¿™éœ€è¦ä½¿ç”¨ `useRouter` é’©å­ã€‚

```vue
<script setup>
import { useRouter } from 'vue-router'

const router = useRouter() // è·å– router å®ä¾‹

function goToAboutPage() {
  router.push('/about')
}

function goToUserPage(userId) {
  // ä¹Ÿå¯ä»¥é€šè¿‡è·¯ç”±åç§°å’Œå‚æ•°è·³è½¬
  router.push({ name: 'user', params: { id: userId }})
}
</script>
```
> **`useRoute` vs `useRouter`**:
> - `useRoute()`: æä¾›å½“å‰è·¯ç”±çš„ä¿¡æ¯ (åªè¯»)ï¼Œå¦‚ `params`, `query` ç­‰ã€‚
> - `useRouter()`: æä¾› `router` å®ä¾‹ï¼Œç”¨äºæ‰§è¡Œå¯¼èˆªæ“ä½œï¼Œå¦‚ `push()`, `replace()`, `go()` ç­‰ã€‚

## ğŸ’‚ å¯¼èˆªå®ˆå«ä¸æƒé™æ§åˆ¶

**å¯¼èˆªå®ˆå«**ä¸»è¦ç”¨æ¥é€šè¿‡è·³è½¬æˆ–å–æ¶ˆçš„æ–¹å¼å®ˆå«å¯¼èˆªã€‚è¿™æ˜¯å®ç°ç™»å½•éªŒè¯ã€é¡µé¢è®¿é—®æƒé™æ§åˆ¶ç­‰åŠŸèƒ½çš„å…³é”®ã€‚

æœ€å¸¸ç”¨çš„æ˜¯**å…¨å±€å‰ç½®å®ˆå«** `router.beforeEach`ã€‚å®ƒåœ¨æ¯æ¬¡è·¯ç”±è·³è½¬ä¹‹å‰éƒ½ä¼šè¢«è§¦å‘ã€‚

```js
// src/router/index.js
import { useAuthStore } from '../stores/auth'

// ... router å®šä¹‰ ...

router.beforeEach((to, from, next) => {
  // `to`: å³å°†è¿›å…¥çš„ç›®æ ‡è·¯ç”±å¯¹è±¡
  // `from`: å½“å‰å¯¼èˆªæ­£è¦ç¦»å¼€çš„è·¯ç”±å¯¹è±¡
  // `next`: å¿…é¡»è°ƒç”¨çš„å‡½æ•°ï¼Œç”¨äºè§£æè¿™ä¸ªé’©å­
  
  const authStore = useAuthStore()
  
  // æ£€æŸ¥è·¯ç”±æ˜¯å¦éœ€è¦è®¤è¯
  if (to.meta.requiresAuth && !authStore.isLoggedIn) {
    // å¦‚æœç”¨æˆ·æœªç™»å½•ï¼Œåˆ™é‡å®šå‘åˆ°ç™»å½•é¡µ
    next({ name: 'login' })
  } else {
    // å¦åˆ™ï¼Œæ­£å¸¸è·³è½¬
    next()
  }
})
```
ä¸ºäº†è®©å®ˆå«çŸ¥é“å“ªä¸ªé¡µé¢éœ€è¦è®¤è¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è·¯ç”±å®šä¹‰ä¸­ä½¿ç”¨ `meta` å­—æ®µæ¥é™„åŠ **å…ƒä¿¡æ¯**ã€‚

```js
// src/router/index.js
const routes = [
  {
    path: '/profile',
    name: 'profile',
    component: ProfileView,
    meta: { requiresAuth: true } // æ·»åŠ å…ƒä¿¡æ¯
  },
  {
    path: '/login',
    name: 'login',
    component: LoginView
  }
]
```

## âš¡ è·¯ç”±æ‡’åŠ è½½

å½“æ„å»ºå¤§å‹åº”ç”¨æ—¶ï¼ŒJavaScript åŒ…ä¼šå˜å¾—éå¸¸å¤§ï¼Œå½±å“é¡µé¢åŠ è½½æ—¶é—´ã€‚**è·¯ç”±æ‡’åŠ è½½**å¯ä»¥å°†ä¸åŒè·¯ç”±å¯¹åº”çš„ç»„ä»¶åˆ†å‰²æˆä¸åŒçš„ä»£ç å—ï¼Œç„¶ååªåœ¨è®¿é—®æŸä¸ªè·¯ç”±æ—¶æ‰åŠ è½½å¯¹åº”çš„ç»„ä»¶ã€‚

å®ç°æ‡’åŠ è½½éå¸¸ç®€å•ï¼Œåªéœ€å°† `component` é€‰é¡¹ä»ä¸€ä¸ªé™æ€ç»„ä»¶æ”¹ä¸ºä¸€ä¸ªåŠ¨æ€çš„ `import` å‡½æ•°å³å¯ã€‚

```js
// src/router/index.js
const routes = [
  {
    path: '/about',
    name: 'about',
    // åŸå§‹æ–¹å¼:
    // component: AboutView
    
    // æ‡’åŠ è½½æ–¹å¼:
    component: () => import('../views/AboutView.vue')
  }
]
```

## ğŸ“š å­¦ä¹ èµ„æº

- **[Vue Router å®˜æ–¹æ–‡æ¡£](https://router.vuejs.org/zh/)**: æœ€æƒå¨çš„å­¦ä¹ èµ„æ–™ã€‚
- **[åŠ¨æ€è·¯ç”±](https://router.vuejs.org/zh/guide/essentials/dynamic-matching.html)**
- **[å¯¼èˆªå®ˆå«](https://router.vuejs.org/zh/guide/advanced/navigation-guards.html)**
- **[è·¯ç”±æ‡’åŠ è½½](https://router.vuejs.org/zh/guide/advanced/lazy-loading.html)**

## ğŸ” çŸ¥è¯†æ£€æŸ¥

- [ ] ç†è§£å•é¡µåº”ç”¨ (SPA) å’Œå‰ç«¯è·¯ç”±çš„åŸºæœ¬åŸç†ã€‚
- [ ] æŒæ¡å¦‚ä½•é…ç½®è·¯ç”±è¡¨ï¼Œå¹¶æ³¨å†Œ Vue Routerã€‚
- [ ] èƒ½å¤Ÿä½¿ç”¨ `<router-view>` å’Œ `<router-link>` æ¥å®ç°åŸºæœ¬çš„é¡µé¢æ¸²æŸ“å’Œå¯¼èˆªã€‚
- [ ] çŸ¥é“å¦‚ä½•å®šä¹‰åŠ¨æ€è·¯ç”±ï¼Œå¹¶ä½¿ç”¨ `useRoute` åœ¨ç»„ä»¶ä¸­è·å–è·¯ç”±å‚æ•°ã€‚
- [ ] èƒ½å¤Ÿä½¿ç”¨ `useRouter` å®ç°ç¼–ç¨‹å¼å¯¼èˆªã€‚
- [ ] æŒæ¡å¦‚ä½•ä½¿ç”¨å…¨å±€å¯¼èˆªå®ˆå« `beforeEach` å’Œè·¯ç”±å…ƒä¿¡æ¯ `meta` å®ç°æƒé™æ§åˆ¶ã€‚
- [ ] ç†è§£è·¯ç”±æ‡’åŠ è½½çš„ä½œç”¨å¹¶çŸ¥é“å¦‚ä½•é…ç½®ã€‚

---

**ä¸Šä¸€èŠ‚**ï¼š[3.3 çŠ¶æ€ç®¡ç†](3.3-state-management.md) | **ä¸‹ä¸€èŠ‚**ï¼š[3.5 å®è·µé¡¹ç›®](3.5-practice-project.md) 