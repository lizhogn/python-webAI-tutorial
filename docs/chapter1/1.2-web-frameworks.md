# 1.2 Web æ¡†æ¶å…¥é—¨

## ğŸ“– æ¦‚è¿°

Web æ¡†æ¶æ˜¯æ„å»º Web åº”ç”¨çš„åŸºç¡€å·¥å…·ï¼Œå®ƒä»¬æä¾›äº†å¤„ç† HTTP è¯·æ±‚ã€è·¯ç”±ç®¡ç†ã€æ¨¡æ¿æ¸²æŸ“ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚æœ¬ç« å°†ä»‹ç»ä¸»æµçš„ Python Web æ¡†æ¶ï¼Œé‡ç‚¹å­¦ä¹  Flask å’Œ FastAPIã€‚

## ğŸŒ Web æ¡†æ¶ç®€ä»‹

### ä»€ä¹ˆæ˜¯ Web æ¡†æ¶

Web æ¡†æ¶æ˜¯ä¸€ä¸ªè½¯ä»¶æ¡†æ¶ï¼Œç”¨äºç®€åŒ– Web åº”ç”¨ç¨‹åºã€Web æœåŠ¡å’Œ Web ç«™ç‚¹çš„å¼€å‘ã€‚å®ƒæä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„æ–¹æ³•æ¥æ„å»ºå’Œéƒ¨ç½² Web åº”ç”¨ã€‚

### Web æ¡†æ¶çš„ä½œç”¨

- **è·¯ç”±ç®¡ç†**ï¼šå°† URL æ˜ å°„åˆ°å¤„ç†å‡½æ•°
- **è¯·æ±‚å¤„ç†**ï¼šè§£æ HTTP è¯·æ±‚å‚æ•°
- **å“åº”ç”Ÿæˆ**ï¼šç”Ÿæˆ HTTP å“åº”
- **æ¨¡æ¿æ¸²æŸ“**ï¼šæ¸²æŸ“ HTML é¡µé¢
- **æ•°æ®åº“é›†æˆ**ï¼šæä¾›æ•°æ®åº“æ“ä½œæ¥å£
- **å®‰å…¨é˜²æŠ¤**ï¼šå¤„ç†è®¤è¯ã€æˆæƒã€CSRF ç­‰

## ğŸ—ï¸ ä¸»æµ Python Web æ¡†æ¶

### æ¡†æ¶å¯¹æ¯”

| æ¡†æ¶ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | å­¦ä¹ éš¾åº¦ |
|------|------|----------|----------|
| **Flask** | è½»é‡çº§ã€çµæ´» | å°å‹é¡¹ç›®ã€åŸå‹å¼€å‘ | ç®€å• |
| **FastAPI** | ç°ä»£ã€é«˜æ€§èƒ½ã€è‡ªåŠ¨æ–‡æ¡£ | API å¼€å‘ã€å¾®æœåŠ¡ | ä¸­ç­‰ |
| **Django** | å…¨åŠŸèƒ½ã€ä¼ä¸šçº§ | å¤§å‹é¡¹ç›®ã€å†…å®¹ç®¡ç† | å¤æ‚ |
| **Tornado** | å¼‚æ­¥ã€é«˜æ€§èƒ½ | å®æ—¶åº”ç”¨ã€é•¿è¿æ¥ | å¤æ‚ |

### é€‰æ‹©å»ºè®®

- **åˆå­¦è€…**ï¼šä» Flask å¼€å§‹ï¼Œå­¦ä¹ åŸºç¡€æ¦‚å¿µ
- **API å¼€å‘**ï¼šé€‰æ‹© FastAPIï¼Œäº«å—ç°ä»£ç‰¹æ€§
- **ä¼ä¸šé¡¹ç›®**ï¼šè€ƒè™‘ Djangoï¼Œè·å¾—å®Œæ•´ç”Ÿæ€
- **é«˜æ€§èƒ½éœ€æ±‚**ï¼šè¯„ä¼° Tornado æˆ– FastAPI

## ğŸš€ Flask åŸºç¡€

### å®‰è£…å’Œé…ç½®

```bash
# å®‰è£… Flask
pip install flask

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate  # Windows
```

### ç¬¬ä¸€ä¸ª Flask åº”ç”¨

```python
from flask import Flask, render_template, request, jsonify

app = Flask(__name__)

@app.route('/')
def home():
    return 'Hello, World!'

@app.route('/about')
def about():
    return 'About Page'

@app.route('/api/users')
def get_users():
    users = [
        {'id': 1, 'name': 'å¼ ä¸‰'},
        {'id': 2, 'name': 'æå››'}
    ]
    return jsonify(users)

@app.route('/user/<int:user_id>')
def get_user(user_id):
    return f'User ID: {user_id}'

if __name__ == '__main__':
    app.run(debug=True)
```

### è·¯ç”±å’Œè§†å›¾å‡½æ•°

```python
# åŸºæœ¬è·¯ç”±
@app.route('/')
def index():
    return 'Index Page'

# å¸¦å‚æ•°çš„è·¯ç”±
@app.route('/user/<username>')
def show_user(username):
    return f'User: {username}'

# æŒ‡å®š HTTP æ–¹æ³•
@app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        username = request.form['username']
        password = request.form['password']
        # å¤„ç†ç™»å½•é€»è¾‘
        return 'Login successful'
    return render_template('login.html')

# å¸¦ç±»å‹è½¬æ¢çš„è·¯ç”±
@app.route('/post/<int:post_id>')
def show_post(post_id):
    return f'Post ID: {post_id}'
```

### è¯·æ±‚å’Œå“åº”

```python
from flask import request, jsonify, make_response

@app.route('/api/data', methods=['POST'])
def handle_data():
    # è·å–è¯·æ±‚æ•°æ®
    data = request.get_json()
    name = data.get('name', '')
    
    # å¤„ç†æ•°æ®
    result = {'message': f'Hello, {name}!', 'status': 'success'}
    
    # è¿”å› JSON å“åº”
    return jsonify(result)

@app.route('/custom-response')
def custom_response():
    response = make_response('Custom Response')
    response.headers['Content-Type'] = 'text/plain'
    response.status_code = 200
    return response
```

### æ¨¡æ¿æ¸²æŸ“

```python
from flask import render_template

@app.route('/profile/<username>')
def profile(username):
    user_info = {
        'name': username,
        'email': f'{username}@example.com',
        'age': 25
    }
    return render_template('profile.html', user=user_info)
```

**templates/profile.html**:
```html
<!DOCTYPE html>
<html>
<head>
    <title>ç”¨æˆ·èµ„æ–™</title>
</head>
<body>
    <h1>{{ user.name }} çš„èµ„æ–™</h1>
    <p>é‚®ç®±: {{ user.email }}</p>
    <p>å¹´é¾„: {{ user.age }}</p>
</body>
</html>
```

## âš¡ FastAPI å…¥é—¨

### å®‰è£…å’Œé…ç½®

```bash
# å®‰è£… FastAPI å’Œ ASGI æœåŠ¡å™¨
pip install fastapi uvicorn

# å®‰è£…å¯é€‰ä¾èµ–
pip install fastapi[all]
```

### ç¬¬ä¸€ä¸ª FastAPI åº”ç”¨

```python
from fastapi import FastAPI
from pydantic import BaseModel
from typing import List, Optional

app = FastAPI(title="My API", version="1.0.0")

# æ•°æ®æ¨¡å‹
class User(BaseModel):
    id: int
    name: str
    email: str
    age: Optional[int] = None

class UserCreate(BaseModel):
    name: str
    email: str
    age: Optional[int] = None

# è·¯ç”±
@app.get("/")
async def root():
    return {"message": "Hello World"}

@app.get("/users", response_model=List[User])
async def get_users():
    users = [
        User(id=1, name="å¼ ä¸‰", email="zhangsan@example.com", age=25),
        User(id=2, name="æå››", email="lisi@example.com", age=30)
    ]
    return users

@app.get("/users/{user_id}", response_model=User)
async def get_user(user_id: int):
    # æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢
    user = User(id=user_id, name="å¼ ä¸‰", email="zhangsan@example.com", age=25)
    return user

@app.post("/users", response_model=User)
async def create_user(user: UserCreate):
    # æ¨¡æ‹Ÿåˆ›å»ºç”¨æˆ·
    new_user = User(id=3, **user.dict())
    return new_user

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

### æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–

```python
from pydantic import BaseModel, EmailStr, validator
from typing import Optional
from datetime import datetime

class User(BaseModel):
    id: int
    name: str
    email: EmailStr
    age: Optional[int] = None
    created_at: datetime = datetime.now()
    
    @validator('age')
    def validate_age(cls, v):
        if v is not None and (v < 0 or v > 150):
            raise ValueError('å¹´é¾„å¿…é¡»åœ¨ 0-150 ä¹‹é—´')
        return v
    
    class Config:
        schema_extra = {
            "example": {
                "id": 1,
                "name": "å¼ ä¸‰",
                "email": "zhangsan@example.com",
                "age": 25
            }
        }
```

### ä¾èµ–æ³¨å…¥

```python
from fastapi import Depends, HTTPException, status
from typing import Optional

# æ¨¡æ‹Ÿæ•°æ®åº“
fake_users_db = {
    "user1": {"username": "user1", "full_name": "User One"},
    "user2": {"username": "user2", "full_name": "User Two"},
}

def get_user(username: str):
    if username in fake_users_db:
        return fake_users_db[username]
    return None

@app.get("/users/me")
async def read_users_me(current_user: dict = Depends(get_user)):
    if current_user is None:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="User not found"
        )
    return current_user
```

### ä¸­é—´ä»¶å’Œå¼‚å¸¸å¤„ç†

```python
from fastapi import Request
import time

@app.middleware("http")
async def add_process_time_header(request: Request, call_next):
    start_time = time.time()
    response = await call_next(request)
    process_time = time.time() - start_time
    response.headers["X-Process-Time"] = str(process_time)
    return response

@app.exception_handler(404)
async def not_found_handler(request: Request, exc: HTTPException):
    return {"message": "èµ„æºæœªæ‰¾åˆ°", "path": request.url.path}
```

## ğŸ”„ æ¡†æ¶å¯¹æ¯”ä¸é€‰æ‹©

### Flask vs FastAPI

| ç‰¹æ€§ | Flask | FastAPI |
|------|-------|---------|
| **æ€§èƒ½** | ä¸­ç­‰ | é«˜æ€§èƒ½ |
| **å¼‚æ­¥æ”¯æŒ** | æœ‰é™ | åŸç”Ÿæ”¯æŒ |
| **è‡ªåŠ¨æ–‡æ¡£** | éœ€è¦æ’ä»¶ | å†…ç½® |
| **ç±»å‹æç¤º** | å¯é€‰ | å¼ºåˆ¶ |
| **å­¦ä¹ æ›²çº¿** | ç®€å• | ä¸­ç­‰ |
| **ç”Ÿæ€ç³»ç»Ÿ** | ä¸°å¯Œ | æ–°å…´ |

### é€‰æ‹©å»ºè®®

1. **é€‰æ‹© Flask çš„åœºæ™¯**ï¼š
   - å­¦ä¹  Web å¼€å‘åŸºç¡€
   - å¿«é€ŸåŸå‹å¼€å‘
   - ç®€å•çš„ Web åº”ç”¨
   - éœ€è¦å¤§é‡ç¬¬ä¸‰æ–¹æ‰©å±•

2. **é€‰æ‹© FastAPI çš„åœºæ™¯**ï¼š
   - æ„å»ºç°ä»£ API
   - éœ€è¦é«˜æ€§èƒ½
   - å›¢é˜Ÿé‡è§†ç±»å‹å®‰å…¨
   - éœ€è¦è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£

## ğŸ’» å®è·µç»ƒä¹ 

### ç»ƒä¹  1ï¼šFlask å¾…åŠäº‹é¡¹åº”ç”¨

```python
from flask import Flask, render_template, request, redirect, url_for

app = Flask(__name__)

# ç®€å•çš„å†…å­˜å­˜å‚¨
todos = []

@app.route('/')
def index():
    return render_template('index.html', todos=todos)

@app.route('/add', methods=['POST'])
def add_todo():
    todo = request.form.get('todo')
    if todo:
        todos.append({'id': len(todos) + 1, 'text': todo, 'done': False})
    return redirect(url_for('index'))

@app.route('/toggle/<int:todo_id>')
def toggle_todo(todo_id):
    for todo in todos:
        if todo['id'] == todo_id:
            todo['done'] = not todo['done']
            break
    return redirect(url_for('index'))

if __name__ == '__main__':
    app.run(debug=True)
```

### ç»ƒä¹  2ï¼šFastAPI ç”¨æˆ·ç®¡ç† API

```python
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
from typing import List, Optional

app = FastAPI()

class User(BaseModel):
    id: int
    name: str
    email: str

class UserCreate(BaseModel):
    name: str
    email: str

# æ¨¡æ‹Ÿæ•°æ®åº“
users_db = []
user_id_counter = 1

@app.post("/users", response_model=User)
async def create_user(user: UserCreate):
    global user_id_counter
    new_user = User(id=user_id_counter, **user.dict())
    users_db.append(new_user)
    user_id_counter += 1
    return new_user

@app.get("/users", response_model=List[User])
async def get_users():
    return users_db

@app.get("/users/{user_id}", response_model=User)
async def get_user(user_id: int):
    for user in users_db:
        if user.id == user_id:
            return user
    raise HTTPException(status_code=404, detail="User not found")
```

## ğŸ“š å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Flask å®˜æ–¹æ–‡æ¡£](https://flask.palletsprojects.com/)
- [FastAPI å®˜æ–¹æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [Django å®˜æ–¹æ–‡æ¡£](https://docs.djangoproject.com/)

### æ¨èé˜…è¯»
- [Flask Web å¼€å‘å®æˆ˜](https://book.douban.com/subject/30268751/)
- [FastAPI æœ€ä½³å®è·µ](https://fastapi.tiangolo.com/tutorial/best-practices/)

## ğŸ” çŸ¥è¯†æ£€æŸ¥

å®Œæˆæœ¬èŠ‚å­¦ä¹ åï¼Œè¯·æ£€æŸ¥æ˜¯å¦æŒæ¡ï¼š

- [ ] ç†è§£ Web æ¡†æ¶çš„ä½œç”¨å’Œç‰¹ç‚¹
- [ ] èƒ½å¤Ÿåˆ›å»ºç®€å•çš„ Flask åº”ç”¨
- [ ] æŒæ¡ Flask çš„è·¯ç”±å’Œè§†å›¾å‡½æ•°
- [ ] èƒ½å¤Ÿåˆ›å»º FastAPI åº”ç”¨
- [ ] ç†è§£æ•°æ®éªŒè¯å’Œä¾èµ–æ³¨å…¥
- [ ] èƒ½å¤Ÿé€‰æ‹©åˆé€‚çš„ Web æ¡†æ¶

---

**ä¸Šä¸€èŠ‚**ï¼š[1.1 HTTP åè®®åŸºç¡€](1.1-http-basics.md) | **ä¸‹ä¸€èŠ‚**ï¼š[1.3 å‰åç«¯äº¤äº’](1.3-frontend-backend.md) 