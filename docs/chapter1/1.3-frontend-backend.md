# 1.3 å‰åç«¯äº¤äº’

## ğŸ“– æ¦‚è¿°

å‰åç«¯äº¤äº’æ˜¯ç°ä»£ Web å¼€å‘çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒæè¿°äº†å‰ç«¯ï¼ˆå®¢æˆ·ç«¯ï¼‰å’Œåç«¯ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰ä¹‹é—´çš„æ•°æ®äº¤æ¢å’Œé€šä¿¡æ–¹å¼ã€‚æœ¬ç« å°†ä»‹ç»å‰åç«¯åˆ†ç¦»æ¶æ„ã€æ•°æ®äº¤æ¢æ ¼å¼ã€AJAX æŠ€æœ¯ç­‰å…³é”®æ¦‚å¿µã€‚

## ğŸ—ï¸ å‰åç«¯åˆ†ç¦»æ¶æ„

### ä¼ ç»Ÿæ¶æ„ vs å‰åç«¯åˆ†ç¦»

#### ä¼ ç»Ÿæ¶æ„ï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰
```
æµè§ˆå™¨ â†’ æœåŠ¡å™¨ â†’ æ•°æ®åº“
   â†‘         â†“
   â† HTML é¡µé¢ â†
```

**ç‰¹ç‚¹**ï¼š
- æœåŠ¡å™¨ç”Ÿæˆå®Œæ•´çš„ HTML é¡µé¢
- é¡µé¢åˆ·æ–°æ—¶é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢
- å‰åç«¯è€¦åˆåº¦é«˜
- å¼€å‘æ•ˆç‡ç›¸å¯¹è¾ƒä½

#### å‰åç«¯åˆ†ç¦»æ¶æ„
```
å‰ç«¯åº”ç”¨ â†â†’ API æœåŠ¡å™¨ â†â†’ æ•°æ®åº“
   â†“           â†“
HTML/CSS/JS   JSON/XML
```

**ç‰¹ç‚¹**ï¼š
- å‰ç«¯å’Œåç«¯ç‹¬ç«‹å¼€å‘
- é€šè¿‡ API è¿›è¡Œæ•°æ®äº¤æ¢
- æ”¯æŒå•é¡µåº”ç”¨ï¼ˆSPAï¼‰
- æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

### æ¶æ„ä¼˜åŠ¿

1. **å¼€å‘æ•ˆç‡**ï¼šå‰åç«¯å¯ä»¥å¹¶è¡Œå¼€å‘
2. **æŠ€æœ¯æ ˆçµæ´»**ï¼šå‰ç«¯å’Œåç«¯å¯ä»¥ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯æ ˆ
3. **å¯ç»´æŠ¤æ€§**ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼ŒèŒè´£åˆ†ç¦»
4. **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒå¤šç«¯åº”ç”¨ï¼ˆWebã€ç§»åŠ¨ç«¯ã€æ¡Œé¢ç«¯ï¼‰
5. **ç”¨æˆ·ä½“éªŒ**ï¼šæ”¯æŒæ— åˆ·æ–°äº¤äº’

## ğŸ“¤ JSON æ•°æ®äº¤æ¢

### JSON ç®€ä»‹

JSONï¼ˆJavaScript Object Notationï¼‰æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼Œæ˜“äºäººé˜…è¯»å’Œç¼–å†™ï¼Œä¹Ÿæ˜“äºæœºå™¨è§£æå’Œç”Ÿæˆã€‚

### JSON è¯­æ³•

```json
{
  "string": "å­—ç¬¦ä¸²",
  "number": 123,
  "boolean": true,
  "null": null,
  "array": [1, 2, 3],
  "object": {
    "name": "å¼ ä¸‰",
    "age": 25
  }
}
```

### Python ä¸­çš„ JSON å¤„ç†

```python
import json

# Python å¯¹è±¡è½¬ JSON å­—ç¬¦ä¸²
data = {
    "name": "å¼ ä¸‰",
    "age": 25,
    "skills": ["Python", "JavaScript", "Vue.js"]
}

json_string = json.dumps(data, ensure_ascii=False, indent=2)
print(json_string)

# JSON å­—ç¬¦ä¸²è½¬ Python å¯¹è±¡
json_data = '{"name": "æå››", "age": 30}'
python_obj = json.loads(json_data)
print(python_obj["name"])
```

### JavaScript ä¸­çš„ JSON å¤„ç†

```javascript
// JavaScript å¯¹è±¡è½¬ JSON å­—ç¬¦ä¸²
const data = {
    name: "å¼ ä¸‰",
    age: 25,
    skills: ["Python", "JavaScript", "Vue.js"]
};

const jsonString = JSON.stringify(data, null, 2);
console.log(jsonString);

// JSON å­—ç¬¦ä¸²è½¬ JavaScript å¯¹è±¡
const jsonData = '{"name": "æå››", "age": 30}';
const jsObj = JSON.parse(jsonData);
console.log(jsObj.name);
```

## ğŸ”„ AJAX å’Œ Fetch API

### AJAX ç®€ä»‹

AJAXï¼ˆAsynchronous JavaScript and XMLï¼‰æ˜¯ä¸€ç§åœ¨æ— éœ€é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿæ›´æ–°éƒ¨åˆ†ç½‘é¡µçš„æŠ€æœ¯ã€‚

### åŸç”Ÿ JavaScript AJAX

```javascript
// åˆ›å»º XMLHttpRequest å¯¹è±¡
const xhr = new XMLHttpRequest();

// é…ç½®è¯·æ±‚
xhr.open('GET', '/api/users', true);

// è®¾ç½®è¯·æ±‚å¤´
xhr.setRequestHeader('Content-Type', 'application/json');

// å¤„ç†å“åº”
xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
        if (xhr.status === 200) {
            const response = JSON.parse(xhr.responseText);
            console.log('ç”¨æˆ·åˆ—è¡¨:', response);
        } else {
            console.error('è¯·æ±‚å¤±è´¥:', xhr.status);
        }
    }
};

// å‘é€è¯·æ±‚
xhr.send();

// POST è¯·æ±‚ç¤ºä¾‹
const xhrPost = new XMLHttpRequest();
xhrPost.open('POST', '/api/users', true);
xhrPost.setRequestHeader('Content-Type', 'application/json');

xhrPost.onreadystatechange = function() {
    if (xhrPost.readyState === 4 && xhrPost.status === 201) {
        const newUser = JSON.parse(xhrPost.responseText);
        console.log('æ–°ç”¨æˆ·:', newUser);
    }
};

const userData = {
    name: "ç‹äº”",
    email: "wangwu@example.com"
};

xhrPost.send(JSON.stringify(userData));
```

### Fetch API

Fetch API æ˜¯ç°ä»£æµè§ˆå™¨æä¾›çš„æ›´ç®€æ´çš„ HTTP è¯·æ±‚æ¥å£ã€‚

```javascript
// GET è¯·æ±‚
fetch('/api/users')
    .then(response => {
        if (!response.ok) {
            throw new Error('ç½‘ç»œå“åº”é”™è¯¯');
        }
        return response.json();
    })
    .then(data => {
        console.log('ç”¨æˆ·åˆ—è¡¨:', data);
    })
    .catch(error => {
        console.error('è¯·æ±‚å¤±è´¥:', error);
    });

// POST è¯·æ±‚
const userData = {
    name: "ç‹äº”",
    email: "wangwu@example.com"
};

fetch('/api/users', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify(userData)
})
.then(response => response.json())
.then(data => {
    console.log('æ–°ç”¨æˆ·:', data);
})
.catch(error => {
    console.error('è¯·æ±‚å¤±è´¥:', error);
});

// ä½¿ç”¨ async/await
async function fetchUsers() {
    try {
        const response = await fetch('/api/users');
        if (!response.ok) {
            throw new Error('ç½‘ç»œå“åº”é”™è¯¯');
        }
        const users = await response.json();
        console.log('ç”¨æˆ·åˆ—è¡¨:', users);
        return users;
    } catch (error) {
        console.error('è¯·æ±‚å¤±è´¥:', error);
    }
}

async function createUser(userData) {
    try {
        const response = await fetch('/api/users', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(userData)
        });
        
        if (!response.ok) {
            throw new Error('åˆ›å»ºç”¨æˆ·å¤±è´¥');
        }
        
        const newUser = await response.json();
        console.log('æ–°ç”¨æˆ·:', newUser);
        return newUser;
    } catch (error) {
        console.error('è¯·æ±‚å¤±è´¥:', error);
    }
}
```

## ğŸŒ CORS è·¨åŸŸå¤„ç†

### ä»€ä¹ˆæ˜¯ CORS

CORSï¼ˆCross-Origin Resource Sharingï¼‰æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºæ§åˆ¶ä¸åŒæºä¹‹é—´çš„èµ„æºè®¿é—®ã€‚

### åŒæºç­–ç•¥

åŒæºç­–ç•¥è¦æ±‚åè®®ã€åŸŸåã€ç«¯å£éƒ½ç›¸åŒï¼š
- `http://localhost:3000` å’Œ `http://localhost:8000` â†’ ä¸åŒæº
- `https://example.com` å’Œ `http://example.com` â†’ ä¸åŒæº
- `http://api.example.com` å’Œ `http://www.example.com` â†’ ä¸åŒæº

### åç«¯ CORS é…ç½®

#### Flask é…ç½®

```python
from flask import Flask
from flask_cors import CORS

app = Flask(__name__)

# å…è®¸æ‰€æœ‰åŸŸåè®¿é—®
CORS(app)

# æˆ–è€…æŒ‡å®šå…è®¸çš„åŸŸå
CORS(app, origins=['http://localhost:3000', 'https://example.com'])

# æˆ–è€…é’ˆå¯¹ç‰¹å®šè·¯ç”±
@app.route('/api/users')
@cross_origin(origins=['http://localhost:3000'])
def get_users():
    return jsonify(users)
```

#### FastAPI é…ç½®

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI()

# æ·»åŠ  CORS ä¸­é—´ä»¶
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000", "https://example.com"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### å‰ç«¯å¤„ç† CORS

```javascript
// åœ¨è¯·æ±‚ä¸­æ·»åŠ å‡­è¯
fetch('/api/users', {
    credentials: 'include',  // åŒ…å« cookies
    headers: {
        'Content-Type': 'application/json',
    }
});

// ä½¿ç”¨ä»£ç†è§£å†³å¼€å‘ç¯å¢ƒè·¨åŸŸ
// åœ¨ package.json ä¸­æ·»åŠ 
{
  "proxy": "http://localhost:8000"
}
```

## ğŸ” è®¤è¯å’Œæˆæƒ

### åŸºæœ¬è®¤è¯

```javascript
// åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ è®¤è¯ä¿¡æ¯
fetch('/api/protected', {
    headers: {
        'Authorization': 'Bearer ' + token,
        'Content-Type': 'application/json',
    }
});
```

### Token ç®¡ç†

```javascript
// å­˜å‚¨ token
localStorage.setItem('token', 'your-jwt-token');

// è·å– token
const token = localStorage.getItem('token');

// åˆ é™¤ token
localStorage.removeItem('token');

// æ£€æŸ¥ token æ˜¯å¦æœ‰æ•ˆ
function isTokenValid() {
    const token = localStorage.getItem('token');
    if (!token) return false;
    
    // æ£€æŸ¥ token æ˜¯å¦è¿‡æœŸ
    try {
        const payload = JSON.parse(atob(token.split('.')[1]));
        return payload.exp > Date.now() / 1000;
    } catch (error) {
        return false;
    }
}
```

## ğŸ’» å®è·µç»ƒä¹ 

### ç»ƒä¹  1ï¼šç”¨æˆ·ç®¡ç†å‰ç«¯

```html
<!DOCTYPE html>
<html>
<head>
    <title>ç”¨æˆ·ç®¡ç†</title>
    <style>
        .user-list {
            margin: 20px 0;
        }
        .user-item {
            padding: 10px;
            border: 1px solid #ddd;
            margin: 5px 0;
        }
        .form-group {
            margin: 10px 0;
        }
        .form-group label {
            display: inline-block;
            width: 80px;
        }
    </style>
</head>
<body>
    <h1>ç”¨æˆ·ç®¡ç†</h1>
    
    <!-- æ·»åŠ ç”¨æˆ·è¡¨å• -->
    <div>
        <h2>æ·»åŠ ç”¨æˆ·</h2>
        <form id="addUserForm">
            <div class="form-group">
                <label>å§“å:</label>
                <input type="text" id="name" required>
            </div>
            <div class="form-group">
                <label>é‚®ç®±:</label>
                <input type="email" id="email" required>
            </div>
            <button type="submit">æ·»åŠ ç”¨æˆ·</button>
        </form>
    </div>
    
    <!-- ç”¨æˆ·åˆ—è¡¨ -->
    <div>
        <h2>ç”¨æˆ·åˆ—è¡¨</h2>
        <button onclick="loadUsers()">åˆ·æ–°åˆ—è¡¨</button>
        <div id="userList" class="user-list"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api';
        
        // åŠ è½½ç”¨æˆ·åˆ—è¡¨
        async function loadUsers() {
            try {
                const response = await fetch(`${API_BASE}/users`);
                const users = await response.json();
                
                const userList = document.getElementById('userList');
                userList.innerHTML = users.map(user => `
                    <div class="user-item">
                        <strong>${user.name}</strong> - ${user.email}
                        <button onclick="deleteUser(${user.id})">åˆ é™¤</button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·å¤±è´¥:', error);
            }
        }
        
        // æ·»åŠ ç”¨æˆ·
        document.getElementById('addUserForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            
            try {
                const response = await fetch(`${API_BASE}/users`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name, email })
                });
                
                if (response.ok) {
                    alert('ç”¨æˆ·æ·»åŠ æˆåŠŸï¼');
                    document.getElementById('addUserForm').reset();
                    loadUsers();
                } else {
                    alert('æ·»åŠ å¤±è´¥');
                }
            } catch (error) {
                console.error('æ·»åŠ ç”¨æˆ·å¤±è´¥:', error);
                alert('æ·»åŠ å¤±è´¥');
            }
        });
        
        // åˆ é™¤ç”¨æˆ·
        async function deleteUser(userId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç”¨æˆ·å—ï¼Ÿ')) return;
            
            try {
                const response = await fetch(`${API_BASE}/users/${userId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('ç”¨æˆ·åˆ é™¤æˆåŠŸï¼');
                    loadUsers();
                } else {
                    alert('åˆ é™¤å¤±è´¥');
                }
            } catch (error) {
                console.error('åˆ é™¤ç”¨æˆ·å¤±è´¥:', error);
                alert('åˆ é™¤å¤±è´¥');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è·å–ç”¨æˆ·åˆ—è¡¨
        loadUsers();
    </script>
</body>
</html>
```

### ç»ƒä¹  2ï¼šé”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€

```javascript
// ç»Ÿä¸€çš„ API è¯·æ±‚å‡½æ•°
class ApiClient {
    constructor(baseURL) {
        this.baseURL = baseURL;
    }
    
    async request(endpoint, options = {}) {
        const url = `${this.baseURL}${endpoint}`;
        const config = {
            headers: {
                'Content-Type': 'application/json',
                ...options.headers
            },
            ...options
        };
        
        try {
            const response = await fetch(url, config);
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            return await response.json();
        } catch (error) {
            console.error('API è¯·æ±‚å¤±è´¥:', error);
            throw error;
        }
    }
    
    async get(endpoint) {
        return this.request(endpoint);
    }
    
    async post(endpoint, data) {
        return this.request(endpoint, {
            method: 'POST',
            body: JSON.stringify(data)
        });
    }
    
    async put(endpoint, data) {
        return this.request(endpoint, {
            method: 'PUT',
            body: JSON.stringify(data)
        });
    }
    
    async delete(endpoint) {
        return this.request(endpoint, {
            method: 'DELETE'
        });
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const api = new ApiClient('http://localhost:8000/api');

// æ˜¾ç¤ºåŠ è½½çŠ¶æ€
function showLoading(elementId) {
    const element = document.getElementById(elementId);
    element.innerHTML = '<div>åŠ è½½ä¸­...</div>';
}

// æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
function showError(elementId, message) {
    const element = document.getElementById(elementId);
    element.innerHTML = `<div style="color: red;">é”™è¯¯: ${message}</div>`;
}

// ä½¿ç”¨ API å®¢æˆ·ç«¯
async function loadUsersWithStatus() {
    const userList = document.getElementById('userList');
    
    try {
        showLoading('userList');
        const users = await api.get('/users');
        
        userList.innerHTML = users.map(user => `
            <div class="user-item">
                <strong>${user.name}</strong> - ${user.email}
                <button onclick="deleteUser(${user.id})">åˆ é™¤</button>
            </div>
        `).join('');
    } catch (error) {
        showError('userList', error.message);
    }
}
```

## ğŸ“š å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Fetch API æ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)
- [CORS è§„èŒƒ](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS)
- [JSON è§„èŒƒ](https://www.json.org/)

### æ¨èé˜…è¯»
- [å‰åç«¯åˆ†ç¦»æœ€ä½³å®è·µ](https://blog.logrocket.com/best-practices-frontend-backend-separation/)
- [AJAX æ•™ç¨‹](https://developer.mozilla.org/en-US/docs/Web/Guide/AJAX)

## ğŸ” çŸ¥è¯†æ£€æŸ¥

å®Œæˆæœ¬èŠ‚å­¦ä¹ åï¼Œè¯·æ£€æŸ¥æ˜¯å¦æŒæ¡ï¼š

- [ ] ç†è§£å‰åç«¯åˆ†ç¦»æ¶æ„çš„ä¼˜åŠ¿
- [ ] æŒæ¡ JSON æ•°æ®æ ¼å¼çš„ä½¿ç”¨
- [ ] èƒ½å¤Ÿä½¿ç”¨ AJAX å’Œ Fetch API
- [ ] ç†è§£ CORS è·¨åŸŸé—®é¢˜åŠè§£å†³æ–¹æ¡ˆ
- [ ] æŒæ¡åŸºæœ¬çš„è®¤è¯å’Œæˆæƒæœºåˆ¶
- [ ] èƒ½å¤Ÿå¤„ç† API è¯·æ±‚çš„é”™è¯¯å’ŒåŠ è½½çŠ¶æ€

---

**ä¸Šä¸€èŠ‚**ï¼š[1.2 Web æ¡†æ¶å…¥é—¨](1.2-web-frameworks.md) | **ä¸‹ä¸€èŠ‚**ï¼š[1.4 å®è·µé¡¹ç›®](1.4-practice-project.md) 